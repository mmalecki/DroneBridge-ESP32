<!DOCTYPE html>
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns="http://www.w3.org/1999/html">
<head>
    <meta name="description" content="Settings for DB for ESP32">
    <meta name="author" content="Wolfgang Christl">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>DB for ESP32 Settings</title>
	<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <meta name="theme-color" content="#3166FF">
    <link inline href="skeleton.css" />
    <link inline href="toastify/toastify.css" />
    <link inline href="dronebridge.css" />
    <script inline src="toastify/toastify.js"></script>
    <script inline src="dronebridge.js"></script>
</head>
<body>
<div class="container">
    <br>
    <div class="twelve columns">
        <img src="DroneBridgeLogo.png" alt="DB Logo">
    </div>
</div>
<div class="container">
    <form id="settings_form">
        <div>
            <h2>Statistics</h2>
            <div class="row">
                <div style="font-size: 1.3rem" id="web_conn_status" class="six columns">
                </div>
            </div>
            <div class="row">
                <div style="font-size: 1.3rem" id="current_client_ip" class="six columns">
                </div>
            </div>
            <div class="row">
                <div class="four columns">
                    <label>UART received bytes</label>
                    <div id="read_bytes">-</div>
                </div>
                <div class="four columns">
                    <label>Connected TCP clients</label>
                    <div id="tcp_connected">-</div>
                </div>
                <div class="four columns">
                    <label>Connected UDP clients</label>
                    <div id="udp_connected">-</div>
                </div>
            </div>
        </div>
        <div>
            <h2>Settings</h2>
            <h3>Wi-Fi</h3>
            <div class="row">
                <div class="twelve columns">
                    <label for="esp32_mode">ESP32 Mode (requires save & reboot)</label>
                    <select id="esp32_mode" name="esp32_mode" form="settings_form" onchange="change_ap_ip_visibility()">
                        <option value="1">WiFi Access Point Mode</option>
                        <option value="2">WiFi Client Mode</option>
                        <option value="3">Wifi Access Point LR Mode</option>
                        <option value="4">ESP-NOW LR Mode AIR</option>
                        <option value="5">ESP-NOW LR Mode GND</option>
                    </select>
                    <div id="esp-lr-ap-disclaimer" style="color: #ff881a; margin-bottom: 0.8rem">LR Mode makes the
                        device invisible for non-LR enabled devices!</br>You will not be able to change the config!</br>
                        Data rate is reduced to ~0.25Mbps. Range may be increase by a factor of ~2.</br>Press boot
                        button (short press for AP-Mode with password "dronebridge" or long press for reset to defaults)
                        or erase the flash memory of the ESP32 and re-flash DroneBridge for ESP32 to get back into
                        normal Wi-Fi Mode!
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="six columns">
                    <label for="wifi_ssid">SSID</label>
                    <input type="text" name="wifi_ssid" value="" id="wifi_ssid">
                </div>
                <div class="six columns">
                    <label for="wifi_pass">Password</label>
                    <input type="text" name="wifi_pass" value="" id="wifi_pass">
                </div>
            </div>
            <div class="row">
                <div id="ap_channel_div" class="twelve columns">
                    <label for="ap_channel">Channel</label>
                    <input type="text" name="ap_channel" value="" id="ap_channel">
                </div>
            </div>
            <h3>Serial</h3>
            <div class="row">
                <div class="six columns">
                    <label for="tx_pin">UART TX Pin</label>
                    <input type="text" name="tx_pin" value="" id="tx_pin">
                </div>
                <div class="six columns">
                    <label for="rx_pin">UART RX Pin</label>
                    <input type="text" name="rx_pin" value="" id="rx_pin">
                </div>
            </div>
            <div class="row">
                <div class="six columns">
                    <label for="rts_pin">UART RTS Pin</label>
                    <input type="text" name="rts_pin" value="" id="rts_pin">
                </div>
                <div class="six columns">
                    <label for="cts_pin">UART CTS Pin</label>
                    <input type="text" name="cts_pin" value="" id="cts_pin">
                </div>
            </div>
            <div class="row">
                <div class="six columns">
                    <label for="rts_thresh">UART RTS threshold</label>
                    <input type="number" id="rts_thresh" name="rts_thresh" min="1" max="128">
                </div>
            </div>
            <div class="row">
                <div class="six columns">
                    <label for="telem_proto">UART serial protocol</label>
                    <select id="telem_proto" name="telem_proto" form="settings_form"
                            onchange="change_msp_ltm_visibility()">
                        <option value="1">MSP/LTM</option>
                        <option value="4">MAVLink</option>
                        <option value="5">Transparent</option>
                    </select>
                </div>
                <div class="six columns">
                    <label for="baud">UART baud</label>
                    <select name="baud" id="baud" form="settings_form">
                        <option value="5000000">5000000</option>
                        <option value="1500000">1500000</option>
                        <option value="1000000">1000000</option>
                        <option value="500000">500000</option>
                        <option value="921600">921600</option>
                        <option value="576000">576000</option>
                        <option value="460800">460800</option>
                        <option value="230400">230400</option>
                        <option value="115200">115200</option>
                        <option value="76800">76800</option>
                        <option value="57600">57600</option>
                        <option value="38400">38400</option>
                        <option value="19200">19200</option>
                        <option value="9600">9600</option>
                        <option value="4800">4800</option>
                        <option value="2400">2400</option>
                        <option value="1200">1200</option>
                    </select>
                </div>
            </div>
            <div id="msp_ltm_div" class="row">
                <div class="twelve columns">
                    <label for="ltm_pp">LTM frames per packet</label>
                    <select id="ltm_pp" name="ltm_pp" form="settings_form">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="6">6</option>
                        <option value="10">10</option>
                    </select>
                </div>
            </div>
            <div id="trans_pack_size_div" class="row">
                <div class="twelve columns">
                    <label for="trans_pack_size">Maximum packet size</label>
                    <select id="trans_pack_size" name="trans_pack_size" form="settings_form">
                        <option value="16">16</option>
                        <option value="32">32</option>
                        <option value="64">64</option>
                        <option value="128">128</option>
                        <option value="256">256</option>
                        <option value="512">512</option>
                        <option value="768">768</option>
                    </select>
                </div>
            </div>
            <div id="ap_ip_div" class="row">
                <div class="six columns">
                    <label for="ap_ip">Gateway IP address</label>
                    <input type="text" name="ap_ip" value="" id="ap_ip">
                </div>
            </div>
            <section id="camera" style="display: block">
                <h3>Camera</h3>
                <div class="row">
                    <div class="three columns">
                        <label for="cam_pin_siod">SIOD Pin</label>
                        <input type="text" name="cam_pin_siod" value="" id="cam_pin_siod">
                    </div>
                    <div class="three columns">
                        <label for="cam_pin_sioc">SIOC Pin</label>
                        <input type="text" name="cam_pin_sioc" value="" id="cam_pin_sioc">
                    </div>
                    <div class="three columns">
                        <label for="cam_pin_xclk">XCLK Pin</label>
                        <input type="text" name="cam_pin_xclk" value="" id="cam_pin_xclk">
                    </div>
                </div>
                <div class="row">
                    <div class="three columns">
                        <label for="cam_pin_vsync">VSYNC Pin</label>
                        <input type="text" name="cam_pin_vsync" value="" id="cam_pin_vsync">
                    </div>
                    <div class="three columns">
                        <label for="cam_pin_href">HREF Pin</label>
                        <input type="text" name="cam_pin_href" value="" id="cam_pin_href">
                    </div>
                    <div class="three columns">
                        <label for="cam_pin_pclk">PCLK Pin</label>
                        <input type="text" name="cam_pin_pclk" value="" id="cam_pin_pclk">
                    </div>
                </div>
                <div class="row">
                    <div class="three columns">
                        <label for="cam_pin_pwdn">PWDN Pin</label>
                        <input type="text" name="cam_pin_pwdn" value="" id="cam_pin_pwdn">
                    </div>
                    <div class="three columns">
                        <label for="cam_pin_reset">RESET Pin</label>
                        <input type="text" name="cam_pin_reset" value="" id="cam_pin_reset">
                    </div>
                </div>
                <div class="row">
                    <div class="three columns">
                        <label for="cam_pin_y2">Y2 Pin</label>
                        <input type="text" name="cam_pin_y2" value="" id="cam_pin_y2">
                    </div>
                    <div class="three columns">
                        <label for="cam_pin_y3">Y3 Pin</label>
                        <input type="text" name="cam_pin_y3" value="" id="cam_pin_y3">
                    </div>
                    <div class="three columns">
                        <label for="cam_pin_y4">Y4 Pin</label>
                        <input type="text" name="cam_pin_y4" value="" id="cam_pin_y4">
                    </div>
                </div>
                <div class="row">
                    <div class="three columns">
                        <label for="cam_pin_y5">Y5 Pin</label>
                        <input type="text" name="cam_pin_y5" value="" id="cam_pin_y5">
                    </div>
                    <div class="three columns">
                        <label for="cam_pin_y6">Y6 Pin</label>
                        <input type="text" name="cam_pin_y6" value="" id="cam_pin_y6">
                    </div>
                    <div class="three columns">
                        <label for="cam_pin_y7">Y7 Pin</label>
                        <input type="text" name="cam_pin_y7" value="" id="cam_pin_y7">
                    </div>
                </div>
                <div class="row">
                    <div class="three columns">
                        <label for="cam_pin_y8">Y8 Pin</label>
                        <input type="text" name="cam_pin_y8" value="" id="cam_pin_y8">
                    </div>
                    <div class="three columns">
                        <label for="cam_pin_y9">Y9 Pin</label>
                        <input type="text" name="cam_pin_y9" value="" id="cam_pin_y9">
                    </div>
                </div>
                <div class="row">
                    <div class="three columns">
                        <label for="cam_frame_size">Frame size</label>
                        <select name="cam_frame_size" id="cam_frame_size" form="settings_form">
                            <option value="0">96X96   (96x96)</option>
                            <option value="1">QQVGA   (160x120)</option>
                            <option value="2">QCIF    (176x144)</option>
                            <option value="3">HQVGA   (240x176)</option>
                            <option value="4">240X240 (240x240)</option>
                            <option value="5">QVGA    (320x240)</option>
                            <option value="6">CIF     (400x296)</option>
                            <option value="7">HVGA    (480x320)</option>
                            <option value="8">VGA     (640x480)</option>
                            <option value="9">SVGA    (800x600)</option>
                            <option value="10">XGA    (1024x768)</option>
                            <option value="11">HD     (1280x720)</option>
                            <option value="12">SXGA   (1280x1024)</option>
                            <option value="13">UXGA   (1600x1200)</option>
                            <option value="14">FHD    (1920x1080)</option>
                            <option value="15">P_HD   ( 720x1280)</option>
                            <option value="16">P_3MP  ( 864x1536)</option>
                            <option value="17">QXGA   (2048x1536)</option>
                            <option value="18">QHD    (2560x1440)</option>
                            <option value="19">WQXGA  (2560x1600)</option>
                            <option value="20">P_FHD  (1080x1920)</option>
                            <option value="21">QSXGA  (2560x1920)</option>
                        </select>
                    </div>
                    <div class="three columns">
                        <label for="cam_jpeg_quality">JPEG quality (lower is better)</label>
                        <input type="number" name="cam_jpeg_quality" min="0" max="63" value="" id="cam_jpeg_quality" />
                    </div>
                    <div class="three columns">
                        <label for="cam_fps">FPS</label>
                        <input type="number" id="cam_fps" name="cam_fps" min="1" max="63" value="" />
                    </div>
                </div>
                <details ontoggle="toggle_camera_preview()">
                    <summary>Camera preview</summary>
                    <p id="cam_preview_loading">Loading...</p>
                    <div id="cam_preview_container"></div>
                </details>
            </section>
        </div>
    </form>
    <div class="row">
        <div class="twelve columns">
            <button class="button-primary" onclick="add_new_udp_client()">add custom UDP target</button>
        </div>
    </div>
    <div class="row">
        <div class="six columns">
            <button class="button-primary" onclick="save_settings()">Save Settings</button>
        </div>
        <div class="six columns">
            <button class="button-primary" onclick="trigger_reboot()">Reboot ESP32</button>
        </div>
    </div>
</div>
<div class="container">
    <div id="esp_mac" style="margin-top: 1rem; font-size: small" class="row"></div>
    <div id="about" class="row">DroneBridge for ESP32 - waiting for a response from the ESP32
    </div>
    <div style="margin-bottom: 2rem" class="row">&copy; Wolfgang Christl 2018 - Apache 2.0 License</div>
</div>
<script>
    // get settings once upon page load
    while (get_system_info() < 0) {
    }
    while (get_settings() < 0) {
    }
    // get stats every half a second
    setInterval(get_stats, 500)
    setInterval(update_conn_status, 500)
    setTimeout(change_msp_ltm_visibility, 500)
    setTimeout(change_ap_ip_visibility, 500)
</script>
</body>
</html>
